<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript"  src="../../../../lib/js/jquery-2.1.0.min.js"></script>
    <title>mpd link overview</title><style type="text/css">
      td {
      margin: 20px;
      }
    </style>
  </head>
  <body>
    <h1>measurement definitions</h1>
    <select id="server">
      <option value="http://localhost">localhost</option>
      {{#servers}}
      <option value="http://{{name}}">{{alias}}</option>
      {{/servers}}
    </select>

    <table id="table" border="0" width="100%">
      <thead>
        <tr>
	  <th align="center"><h2>mpd</h2></th>
          <th align="left"><h2>ssmp load</h2></th>
          <th align="left"><h2>ssmp remove</h2></th>
	  <th align="left"><h2>frame state</h2></th>
	  <th align="left"><h2>frame elements</h2></th>
	  <th align="left"><h2>ssmp exchange</h2></th>
	  <th align="left"><h2>ssmp meta</h2></th>
	  <th align="left"><h2>ssmp all</h2></th>
          <th align="left"><h2>couchdb link</h2></th>
        </tr>
      </thead>
      <tbody>
        {{#mpdocs}}
        <tr>
	  <td><b>{{value}}</b></td>
          <td><button class="load" id='{{id}}'>load</button></td>
          <td><button class="remove" id='{{id}}'>remove</button></td>

	  <td><a class='test-link' target='_blank' title='frame/state'
                 data-path='/{{id}}/0/state/frame'
		 data-port='8002'
                 href='http://localhost:8002/{{id}}/0/state/frame'>state</a></td>

	  <td><a class='test-link' target='_blank' title='frame/state'
		 data-path='/{{id}}/0/elements/frame'
		 data-port='8002'
                 href='http://localhost:8002/{{id}}/0/elements/frame'>elements</a></td>
          
          <td><a class='test-link' target='_blank' title='state'
		 data-path='/{{id}}/exchange'
		 data-port='8001'
                 href='http://localhost:8001/{{id}}/exchange'>exchange</a></td>
	  
          <td><a class='test-link' target='_blank' title='state'
		 data-path='/{{id}}/meta'
		 data-port='8001'
                 href='http://localhost:8001/{{id}}/meta'>meta</a></td>
          <td><a class='test-link' target='_blank' title='state'
		 data-path='/{{id}}'
		 data-port='8001'
		 href='http://localhost:8001/{{id}}'>all</a></td>
	  
	  <td><a target='_blank' title='{{display}}'
		 href='http://localhost:5984/_utils/#/database/vl_db/{{id}}'>{{value}}</a></td>
	</tr>
	{{/mpdocs}}
      </tbody>
    </table>
    <script>
      $( "#server").on('change', function() {
      var server = $(this).val();
      $tl = $(".test-link");
      $tl.each(function(i){
      
      that = $tl.eq(i);
      url = server + ":" + that.data("port") + that.data("path");
      that.attr("href", url);

      (function(u, t){
      $.ajax({url: u,
      timeout:2000})
      .done(function(data) {
      if(data == "object is undefined"){
        t.css('color', '#FCFCFC');
        t.parent().css('background-color', '#AAA039');
      }else{
        t.css('color', '#FCFCFC');
        t.parent().css('background-color', '#90A437');
      }
     
      })
      .fail(function() {
      t.css('color', '#FCFCFC');
      t.parent().css('background-color', '#71266E');
    
      })
      .always(function() { 
    
      });
      })(url, that)
      })
      });
      
      $( "button" ).click(function() {
      
      var $this = $(this)
      , id = $this.attr("id")
      , conf = {type: "PUT", url: "http://localhost:8001/" + id }

      if($this.hasClass("load")){
      conf.data = "load"
      }

      if($this.hasClass("remove")){
      conf.data = "remove"
      }
      $.ajax(conf);
      });
    </script>
  </body>
</html>